{% extends 'base.html' %}
{% block title %}Ders Notlarƒ±m{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-primary">üìö Ders Notlarƒ±m</h2>
                <div class="badge bg-info fs-6">
                    {{ ogrenci.sinif_info }} - {{ ogrenci.ad_soyad }}
                </div>
            </div>

            {% if notlar %}
                <!-- Notlar Tablosu -->
                <div class="card shadow">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th rowspan="2" class="align-middle text-center">Ders Adƒ±</th>
                                        <th colspan="4" class="text-center text-warning">ü•á 1. D√∂nem</th>
                                        <th colspan="4" class="text-center text-info">ü•à 2. D√∂nem</th>
                                        <th rowspan="2" class="align-middle text-center text-success">üèÜ Yƒ±l Sonu</th>
                                        <th rowspan="2" class="align-middle text-center">Durum</th>
                                    </tr>
                                    <tr>
                                        <th class="text-center">Test</th>
                                        <th class="text-center">Yazƒ±lƒ±</th>
                                        <th class="text-center">S√∂zl√º</th>
                                        <th class="text-center text-warning">Ortalama</th>
                                        <th class="text-center">Test</th>
                                        <th class="text-center">Yazƒ±lƒ±</th>
                                        <th class="text-center">S√∂zl√º</th>
                                        <th class="text-center text-info">Ortalama</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for not in notlar %}
                                    <tr>
                                        <td class="fw-bold text-primary">{{ not.ders.ad }}</td>
                                        
                                        <!-- 1. D√∂nem Notlarƒ± -->
                                        <td class="text-center">
                                            {% if not.donem1_test %}
                                                <span class="badge bg-secondary">{{ not.donem1_test|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.donem1_yazili %}
                                                <span class="badge bg-secondary">{{ not.donem1_yazili|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.donem1_sozlu %}
                                                <span class="badge bg-secondary">{{ not.donem1_sozlu|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.ortalama1 %}
                                                <span class="badge bg-warning text-dark fw-bold">{{ not.ortalama1|floatformat:1 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        
                                        <!-- 2. D√∂nem Notlarƒ± -->
                                        <td class="text-center">
                                            {% if not.donem2_test %}
                                                <span class="badge bg-secondary">{{ not.donem2_test|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.donem2_yazili %}
                                                <span class="badge bg-secondary">{{ not.donem2_yazili|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.donem2_sozlu %}
                                                <span class="badge bg-secondary">{{ not.donem2_sozlu|floatformat:0 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-center">
                                            {% if not.ortalama2 %}
                                                <span class="badge bg-info fw-bold">{{ not.ortalama2|floatformat:1 }}</span>
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        
                                        <!-- Yƒ±l Sonu Ortalama -->
                                        <td class="text-center">
                                            {% if not.yil_sonu_ortalama %}
                                                {% if not.yil_sonu_ortalama >= 85 %}
                                                    <span class="badge bg-success fs-6">{{ not.yil_sonu_ortalama|floatformat:1 }}</span>
                                                {% elif not.yil_sonu_ortalama >= 70 %}
                                                    <span class="badge bg-primary fs-6">{{ not.yil_sonu_ortalama|floatformat:1 }}</span>
                                                {% elif not.yil_sonu_ortalama >= 55 %}
                                                    <span class="badge bg-warning text-dark fs-6">{{ not.yil_sonu_ortalama|floatformat:1 }}</span>
                                                {% elif not.yil_sonu_ortalama >= 45 %}
                                                    <span class="badge bg-orange fs-6">{{ not.yil_sonu_ortalama|floatformat:1 }}</span>
                                                {% else %}
                                                    <span class="badge bg-danger fs-6">{{ not.yil_sonu_ortalama|floatformat:1 }}</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        
                                        <!-- Ge√ßme Durumu -->
                                        <td class="text-center">
                                            {% if not.yil_sonu_ortalama %}
                                                {% if not.yil_sonu_ortalama >= 45 %}
                                                    <span class="badge bg-success">‚úì Ge√ßti</span>
                                                {% else %}
                                                    <span class="badge bg-danger">‚úó Kaldƒ±</span>
                                                {% endif %}
                                            {% else %}
                                                <span class="badge bg-secondary">Belirsiz</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ƒ∞statistikler -->
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h5>Ge√ßilen Dersler</h5>
                                <h3>
                                    {% widthratio notlar|length 1 1 as total_dersler %}
                                    {{ notlar|length|add:"-1"|add:"1" }}
                                    {% comment %}Buraya ge√ßilen ders sayƒ±sƒ± hesaplamasƒ± eklenebilir{% endcomment %}
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <h5>Toplam Ders</h5>
                                <h3>{{ notlar|length }}</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-dark">
                            <div class="card-body text-center">
                                <h5>Genel Ortalama</h5>
                                <h3>
                                    {% comment %}Genel ortalama hesaplamasƒ±{% endcomment %}
                                    --
                                </h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <h5>En Y√ºksek Not</h5>
                                <h3>
                                    {% comment %}En y√ºksek not hesaplamasƒ±{% endcomment %}
                                    --
                                </h3>
                            </div>
                        </div>
                    </div>
                </div>

            {% else %}
                <!-- Bo≈ü Durum -->
                <div class="text-center py-5">
                    <div class="card border-0">
                        <div class="card-body">
                            <div class="mb-4">
                                <i class="fas fa-clipboard-list fa-5x text-muted"></i>
                            </div>
                            <h4 class="text-muted">Hen√ºz Hi√ß Notunuz Yok</h4>
                            <p class="text-muted">√ñƒüretmenleriniz notlarƒ±nƒ±zƒ± girdikten sonra burada g√∂r√ºnt√ºleyebileceksiniz.</p>
                            <a href="{% url 'dashboard' %}" class="btn btn-primary">
                                <i class="fas fa-home"></i> Ana Sayfaya D√∂n
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.bg-orange {
    background-color: #fd7e14 !important;
}
</style>
{% endblock %}