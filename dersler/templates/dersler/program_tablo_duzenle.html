{% extends 'base.html' %}
{% load program_filters %}

{% block content %}


<div class="container-fluid mt-4">
    <h3>ðŸ“… Ders ProgramÄ± DÃ¼zenle</h3>
    
    <!-- SÄ±nÄ±f SeÃ§imi -->
    <form method="get" class="mb-4">
        <div class="row">
            <div class="col-md-3">
                <select name="sinif_seviye" class="form-control" required>
                    <option value="">SÄ±nÄ±f SeÃ§</option>
                    <option value="1" {% if sinif_seviye == '1' %}selected{% endif %}>1. SÄ±nÄ±f</option>
                    <option value="2" {% if sinif_seviye == '2' %}selected{% endif %}>2. SÄ±nÄ±f</option>
                    <option value="3" {% if sinif_seviye == '3' %}selected{% endif %}>3. SÄ±nÄ±f</option>
                    <option value="4" {% if sinif_seviye == '4' %}selected{% endif %}>4. SÄ±nÄ±f</option>
                    <option value="5" {% if sinif_seviye == '5' %}selected{% endif %}>5. SÄ±nÄ±f</option>
                    <option value="6" {% if sinif_seviye == '6' %}selected{% endif %}>6. SÄ±nÄ±f</option>
                    <option value="7" {% if sinif_seviye == '7' %}selected{% endif %}>7. SÄ±nÄ±f</option>
                    <option value="8" {% if sinif_seviye == '8' %}selected{% endif %}>8. SÄ±nÄ±f</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="sube" class="form-control" required>
                    <option value="">Åžube SeÃ§</option>
                    <option value="A" {% if sube == 'A' %}selected{% endif %}>A</option>
                    <option value="B" {% if sube == 'B' %}selected{% endif %}>B</option>
                    <option value="C" {% if sube == 'C' %}selected{% endif %}>C</option>
                    <option value="D" {% if sube == 'D' %}selected{% endif %}>D</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary">GÃ¶ster</button>
            </div>
        </div>
    </form>

    {% if sinif_seviye and sube %}
    <!-- Program Tablosu -->
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="sinif_seviye" value="{{ sinif_seviye }}">
        <input type="hidden" name="sube" value="{{ sube }}">
        
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 120px;">Saat</th>
                        {% for gun in gunler %}
                            <th>{{ gun|title }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for saat in saatler %}
                    <tr>
                        <td><strong>{{ saat }}. Ders</strong><br>
                            <small>
                                {% if saat == '1' %}08:00-08:45
                                {% elif saat == '2' %}09:00-09:45
                                {% elif saat == '3' %}10:00-10:45
                                {% elif saat == '4' %}11:00-11:45
                                {% elif saat == '5' %}13:00-13:45
                                {% elif saat == '6' %}14:00-14:45
                                {% endif %}
                            </small>
                        </td>
                        {% for gun in gunler %}
                            {% with key=gun|add:"_"|add:saat %}
                                <td>
                                    <!-- Ders SeÃ§imi -->
                                    <select name="ders_{{ gun }}_{{ saat }}" class="form-control form-control-sm mb-1">
                                        <option value="">-</option>
                                        {% for ders in dersler %}
                                            <option value="{{ ders.id }}" 
                                                {% if program_data|get_item:key and program_data|get_item:key|get_item:'ders_id' == ders.id %}selected{% endif %}>
                                                {{ ders.ad }}
                                            </option>
                                        {% endfor %}
                                    </select>

                                    <!-- Ã–ÄŸretmen SeÃ§imi -->
                                    <select name="ogretmen_{{ gun }}_{{ saat }}" class="form-control form-control-sm">
                                        <option value="">-</option>
                                        {% for ogretmen in ogretmenler %}
                                            <option value="{{ ogretmen.id }}"
                                                {% if program_data|get_item:key and program_data|get_item:key|get_item:'ogretmen_id' == ogretmen.id %}selected{% endif %}>
                                                {{ ogretmen.get_full_name }} ({{ ogretmen.brans }})
                                            </option>
                                        {% endfor %}
                                    </select>
                                </td>
                            {% endwith %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <button type="submit" class="btn btn-success btn-lg">ðŸ’¾ ProgramÄ± Kaydet</button>
    </form>
    {% endif %}
</div>

{% endblock %}