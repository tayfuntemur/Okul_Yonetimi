{% extends 'base.html' %}
{% block title %}Şifre Değiştir - Okul Yönetimi{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">
            <!-- Security Alert Card -->
            <div class="alert-card mb-4">
                <div class="alert-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="alert-content">
                    <h5 class="alert-title">Güvenlik Uyarısı</h5>
                    <p class="alert-text">İlk girişiniz, güvenlik için lütfen şifrenizi değiştirin.</p>
                </div>
            </div>

            <!-- Password Change Form -->
            <div class="change-password-card">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <h3 class="card-title">Şifrenizi Değiştirin</h3>
                    <p class="card-subtitle">Hesap güvenliğinizi sağlamak için güçlü bir şifre seçin</p>
                </div>

                <form method="post" class="password-form">
                    {% csrf_token %}
                    
                    {% for field in form %}
                        <div class="form-group mb-4">
                            <label class="form-label">
                                <i class="fas fa-lock me-2"></i>
                                {{ field.label }}
                            </label>
                            
                            <div class="input-container">
                                {{ field }}
                                <button type="button" class="password-toggle" onclick="togglePassword('{{ field.id_for_label }}')">
                                    <i class="fas fa-eye" id="eye-{{ field.id_for_label }}"></i>
                                </button>
                            </div>
                            
                            {% if field.errors %}
                                <div class="error-message">
                                    <i class="fas fa-exclamation-triangle me-1"></i>
                                    {{ field.errors.0 }}
                                </div>
                            {% endif %}
                            
                            {% if field.help_text %}
                                <div class="help-text">
                                    <i class="fas fa-info-circle me-1"></i>
                                    {{ field.help_text }}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}

                    <!-- Password Strength Indicator -->
                    <div class="password-strength mb-4">
                        <div class="strength-label">Şifre Gücü:</div>
                        <div class="strength-meter">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <div class="strength-text" id="strengthText">Şifre girin</div>
                    </div>

                    <!-- Security Tips -->
                    <div class="security-tips mb-4">
                        <h6>Güçlü Şifre İçin:</h6>
                        <ul class="tips-list">
                            <li><i class="fas fa-check-circle"></i> En az 8 karakter kullanın</li>
                            <li><i class="fas fa-check-circle"></i> Büyük ve küçük harfler ekleyin</li>
                            <li><i class="fas fa-check-circle"></i> Sayılar ve özel karakterler kullanın</li>
                            <li><i class="fas fa-check-circle"></i> Kişisel bilgileri kullanmayın</li>
                        </ul>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn-change-password">
                            <i class="fas fa-shield-alt me-2"></i>
                            Şifreyi Değiştir
                        </button>
                        
                        <a href="{% url 'home' %}" class="btn-cancel">
                            <i class="fas fa-times me-2"></i>
                            İptal
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<script>
// Password visibility toggle
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const eye = document.getElementById('eye-' + fieldId);
    
    if (field.type === 'password') {
        field.type = 'text';
        eye.classList.remove('fa-eye');
        eye.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        eye.classList.remove('fa-eye-slash');
        eye.classList.add('fa-eye');
    }
}

// Password strength checker
document.addEventListener('DOMContentLoaded', function() {
    const passwordFields = document.querySelectorAll('input[type="password"]');
    const strengthBar = document.getElementById('strengthBar');
    const strengthText = document.getElementById('strengthText');
    
    if (passwordFields.length > 0 && strengthBar && strengthText) {
        const newPasswordField = passwordFields[1]; // Usually the "new password" field
        
        if (newPasswordField) {
            newPasswordField.addEventListener('input', function() {
                const password = this.value;
                const strength = checkPasswordStrength(password);
                updateStrengthIndicator(strength);
            });
        }
    }
    
    function checkPasswordStrength(password) {
        let score = 0;
        let feedback = [];
        
        if (password.length >= 8) score += 1;
        else feedback.push('En az 8 karakter');
        
        if (/[a-z]/.test(password)) score += 1;
        else feedback.push('Küçük harf');
        
        if (/[A-Z]/.test(password)) score += 1;
        else feedback.push('Büyük harf');
        
        if (/[0-9]/.test(password)) score += 1;
        else feedback.push('Sayı');
        
        if (/[^A-Za-z0-9]/.test(password)) score += 1;
        else feedback.push('Özel karakter');
        
        return { score, feedback };
    }
    
    function updateStrengthIndicator(strength) {
        const { score, feedback } = strength;
        let width, color, text;
        
        switch (score) {
            case 0:
            case 1:
                width = '20%';
                color = '#dc3545';
                text = 'Çok zayıf';
                break;
            case 2:
                width = '40%';
                color = '#fd7e14';
                text = 'Zayıf';
                break;
            case 3:
                width = '60%';
                color = '#ffc107';
                text = 'Orta';
                break;
            case 4:
                width = '80%';
                color = '#20c997';
                text = 'Güçlü';
                break;
            case 5:
                width = '100%';
                color = '#28a745';
                text = 'Çok güçlü';
                break;
        }
        
        strengthBar.style.width = width;
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = text;
        strengthText.style.color = color;
    }
});
</script>
{% endblock %}